version: '3.8'

services:
  osrm-server:
    image: ghcr.io/project-osrm/osrm-backend:latest
    container_name: osrm-server
    user: "${DOCKER_USER:-1000:1001}"
    ports:
      - "${OSRM_PORT:-5000}:5000"
    volumes:
      - "${OSRM_DATA_PATH:-./data/processed}:/data:ro"
    command: osrm-routed --algorithm mld /data/california-latest.osrm
    environment:
      - OSRM_THREADS=${OSRM_THREADS:-4}
      - OSRM_MAX_LOCATIONS_TRIP=${OSRM_MAX_LOCATIONS_TRIP:-100}
      - OSRM_MAX_LOCATIONS_VIAROUTE=${OSRM_MAX_LOCATIONS_VIAROUTE:-100}
    restart: unless-stopped
