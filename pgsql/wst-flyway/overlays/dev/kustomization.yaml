apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base

nameSuffix: -dev

patches:
- patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: wst-flyway
      namespace: pgsql
    spec:
      template:
        metadata:
          labels:
            environment: dev
        spec:
          initContainers:
          - name: wst-flyway-migrate
            image: ghcr.io/x81k25/wst-flyway:dev
            envFrom:
            - configMapRef:
                name: flyway-config-dev
            - secretRef:
                name: flyway-secrets-dev
          containers:
          - name: wst-flyway-main
            image: ghcr.io/x81k25/wst-flyway:dev
  target:
    kind: Deployment
    name: wst-flyway

patchesStrategicMerge:
- cronjob-restart-patch.yaml

commonLabels:
  environment: dev